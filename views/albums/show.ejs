<%- include('../partials/header') %>
<main>
    <h1>ALBUM DETAILS</h1>
    <section id="details-page">
        <img src="<%= album.img %>" alt="<%= album.title %>" id="detail-pic"></br>
        <div>Title: </div>
        <div><%= album.title %></div>
        <div>Artist: </div>
        <div><%= album.artist %></div>
        <div>Release Date: </div>
        <div><%= (album.releaseDate).toLocaleDateString() %></div>
        <div>Genre: </div>
        <div><%= album.genre %></div>
        <div>Explicit: </div>
        <div><%= album.explicit ? 'Yes' : 'No' %></div>
    </section></br>
    
    <br><h2>Reviews</h2>
    <%if (user) {%>
        <div>
            <form id="add-review-form" method="POST"
              action="/albums/<%= album._id %>/reviews">
              <label>Review:</label>
              <textarea name="content"></textarea>
              <label>Rating:</label>
              <select name="rating">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
              <input type="submit" value="Add Review">
            </form>
        </div>
    <% } %>
        
    <% if (album.reviews.length) { %>
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>Date</th>
                    <th>Review</th>
                    <th>Rating</th>
                </tr>
            </thead>
            <tbody>
                <% album.reviews.forEach(function(r) { %>
                    <tr>
                        <td><%= r.userName %></td>
                        <td><%= r.createdAt.toLocaleDateString() %></td>
                        <td><%= r.content %></td>
                        <td><%= r.rating %></td>
                        <%if (user) { %>
                        <td>
                            <a href="/albums/<%= album._id %>/reviews/<%= r._id%>/edit">Edit</a>
                        </td>
                        <td>
                            <form action="/albums/<%= album._id %>/reviews/<%= r._id %>?_method=DELETE" method="POST">
                                <input type="submit" value="DELETE">
                            </form>
                        </td>
                        <% } %>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    <% } else { %>
        <h5>No Reviews Yet</h5>
    <% } %>

<%- include('../partials/footer') %>